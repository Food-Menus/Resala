<!DOCTYPE html>
<html lang="ar" dir="rtl">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>October High Institute</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" href="./اساسيات/Logo_OHI_min.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="./style.css">
</head>

<body>

    <div class="sidebar">
        <h2 class="sidebar-logo">October High Institute</h2>
        <div class="sidebar-menus">
            <a href="https://www.facebook.com/ohinstitute">الصفحة الرسمية</a>
            <a href="https://www.ohi.edu.eg/default.aspx">الموقع الرسمي</a>
            <a href="https://wa.me/+201102716716?text=مرحبا اريد التواصل معكم">الدعم الفني</a>
            <a href="./about.html">من نحن</a>
            <a href="#" class="menu-off">إغلاق</a>
        </div>
    </div>

    <div class="navbar">
        <div class="menu-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32" fill="currentColor">
                <path d="M5 5H13V19H5V5ZM19 19H15V5H19V19ZM4 3C3.44772 3 3 3.44772 3 4V20C3 20.5523 3.44772 21 4 21H20C20.5523 21 21 20.5523 21 20V4C21 3.44772 20.5523 3 20 3H4ZM7 12L11 8.5V15.5L7 12Z"></path>
            </svg>
        </div>
        <img class="header-logo" src="./اساسيات/logo.jpg" alt="شعار مطعم OHI">
        <!-- أيقونة الموقع -->
        <a href="./index.html" class="user">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" fill="currentColor"><path d="M12 2C17.52 2 22 6.48 22 12C22 17.52 17.52 22 12 22C6.48 22 2 17.52 2 12C2 6.48 6.48 2 12 2ZM12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20ZM12 11H16V13H12V16L8 12L12 8V11Z"></path></svg>        </a>
    </div>

    <div class="main-content">

        <h1 class="page-title">نموذج تسجيل الطلاب</h1>

        <div class="registration-form">
            <form id="registration-form" name="registration-form">
                <div class="form-group">
                    <label for="name">الاسم الكامل:</label>
                    <input type="text" id="name" name="name" class="form-control" pattern="[\u0600-\u06FF\s]+" title="يُسمح فقط بالحروف العربية" required>
                </div>
                
                <div class="form-group">
                    <label for="code">الكود الجامعي:</label>
                    <input type="number" id="code" name="code" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="age">العمر:</label>
                    <input type="number" id="age" name="age" class="form-control" min="16" max="30" required>
                </div>
                
                <div class="form-group">
                    <label for="number">رقم الهاتف:</label>
                    <input type="tel" id="number" name="number" class="form-control" pattern="[0-9]{11}" title="يجب أن يتكون رقم الهاتف من 11 رقمًا" required>
                </div>
        
                <div class="form-group">
                    <label for="email">البريد الإلكتروني:</label>
                    <input type="email" id="email" name="email" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="department">القسم:</label>
                    <select id="department" name="department" class="form-control" required>
                        <option value="">اختر القسم</option>
                        <option value="cs">استثمار وبنوك</option>
                        <option value="it">نظم معلومات الاعمال</option>
                        <option value="is">إدار اعمال</option>
                        <option value="ai">تسويق</option>
                    </select>
                </div>
                
                <button type="submit" class="submit-btn" id="submitBtn">تسجيل</button>
                
                <!-- رسالة جاري الإرسال -->
                <div id="loadingMessage" style="display: none; text-align: center; margin-top: 15px;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">جاري التحميل...</span>
                    </div>
                    <p style="margin-top: 10px;">جاري إرسال البيانات، الرجاء الانتظار...</p>
                </div>
            </form>
        </div>

        <hr>

    </div>

    
    <div class="data-container">
        <h1 class="data-title">بيانات الطلاب المسجلين</h1>
        
        <div id="data-container">
            <!-- سيتم ملء البطاقات هنا بواسطة JavaScript -->
            <div style="text-align: center; grid-column: 1 / -1;">جاري تحميل البيانات...</div>
        </div>
    </div>
        
    <button id="logoutButton" class="logout-btn">  تسجيل الخروج  </button><br>

    <div class="footer">
        <p> ©2025 حقوق النشر طلاب معهد اكتوبر العالي للهندسة</p>
    </div>
    
    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbwrj9OpVczwOuocRk5U3zw2KVOKRSXzfJqHkNyE3gbJKnY9kjp5hjA_Lgs7wzGSkII/exec";
        const form = document.forms["registration-form"];
        const submitBtn = document.getElementById("submitBtn");
        const loadingMessage = document.getElementById("loadingMessage");
        
        form.addEventListener("submit", (e) => {
            e.preventDefault();
            
            // التحقق من صحة النموذج قبل الإرسال
            if(!form.checkValidity()) {
                Swal.fire('خطأ', 'يرجى ملء جميع الحقول المطلوبة بشكل صحيح', 'error');
                return;
            }
            
            // تعطيل الزر وإظهار رسالة التحميل
            submitBtn.disabled = true;
            loadingMessage.style.display = "block";
            
            fetch(scriptURL, { 
                method: "POST", 
                body: new FormData(form) 
            })
            .then((response) => {
                if(response.ok) {
                    Swal.fire('تم بنجاح', 'تم تسجيل البيانات بنجاح', 'success');
                    form.reset();
                } else {
                    throw new Error('Network response was not ok');
                }
            })
            .catch((error) => {
                Swal.fire('خطأ', 'حدث خطأ أثناء محاولة التسجيل', 'error');
                console.error('Error:', error);
            })
            .finally(() => {
                // إعادة تمكين الزر وإخفاء رسالة التحميل
                submitBtn.disabled = false;
                loadingMessage.style.display = "none";
            });
        });
    
        document.addEventListener('DOMContentLoaded', () => {
            const username = localStorage.getItem('username');
            if (!username) {
                window.location.href = './auth.html';
            } else {
                document.getElementById('username').textContent = username;
            }
        });
        
        const logoutButton = document.getElementById('logoutButton');
        if(logoutButton) {
            logoutButton.addEventListener('click', () => {
                localStorage.removeItem('username');
                localStorage.removeItem('password');
                window.location.href = './../../index.html';
                swal("تم تسجيل الخروج", "تم تسجيل الخروج بنجاح.", "success");
            });
        }
    </script>

    <script>

        // جلب وعرض بيانات الطلاب من Google Sheets
        const sheetID = '1jPKYsdxnocGk3Y8lJg00C_nppVLhEm07-v-LAx-gnq0';
        const base = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json`;

        fetch(base)
            .then(response => response.text())
            .then(data => {
                const json = JSON.parse(data.substring(47).slice(0, -2));
                const tableData = json.table.rows;
                const dataContainer = document.getElementById('data-container');
                
                // مسح رسالة التحميل
                dataContainer.innerHTML = '';
                
                if (!tableData || tableData.length === 0) {
                    dataContainer.innerHTML = '<div style="text-align: center; grid-column: 1 / -1;">لا توجد بيانات متاحة</div>';
                    return;
                }

                tableData.forEach((row, index) => {
                    const card = document.createElement('div');
                    card.classList.add('card');

                    const name = row.c && row.c[0] ? row.c[0].v : "غير متوفر";
                    const code = row.c && row.c[1] ? row.c[1].v : "غير متوفر";
                    const age = row.c && row.c[2] ? row.c[2].v : "غير متوفر";
                    const number = row.c && row.c[3] ? row.c[3].v : "غير متوفر";
                    const email = row.c && row.c[4] ? row.c[4].v : "غير متوفر";
                    const department = row.c && row.c[5] ? row.c[5].v : "غير محدد";

                    const registeredId = `registered-${index}`;
                    const activeId = `active-${index}`;

                    card.innerHTML = `
                        <div class="card-content">
                            <h2>الاسم: ${name}</h2>
                        </div>
                        <div class="card-content">
                            <div class="card-title">الكود الجامعي: ${code}</div>
                        </div>
                        <div class="card-content">
                            <div class="card-title">العمر: ${age}</div>
                        </div>
                        <div class="card-content">
                            <div class="card-title">رقم الهاتف: ${number}</div>
                        </div>
                        <div class="card-content">
                            <div class="card-title">البريد الإلكتروني: ${email}</div>
                        </div>
                        <div class="card-content">
                            <div class="card-title">القسم: ${getDepartmentName(department)}</div>
                        </div>

                    `;
                
                    dataContainer.appendChild(card);

                });
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('data-container').innerHTML = `
                    <div style="text-align: center; grid-column: 1 / -1; color: var(--primary);">
                        حدث خطأ أثناء جلب البيانات، يرجى المحاولة لاحقاً
                    </div>
                `;
                Swal.fire('خطأ', 'حدث خطأ أثناء جلب البيانات', 'error');
            });

        // تحويل كود القسم إلى اسم قابل للقراءة
        function getDepartmentName(code) {
            const departments = {
                'cs': 'علوم الحاسب',
                'it': 'تكنولوجيا المعلومات',
                'is': 'نظم المعلومات',
                'ai': 'الذكاء الاصطناعي'
            };
            return departments[code] || code || 'غير محدد';
        }
    </script>

    <script src="javascript.js"></script>

</body>

</html> 